<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Composter Master - LIVE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Inter', sans-serif; }
        .glass { background: #161b22; border: 1px solid #30363d; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        select { background: #0d1117; border: 1px solid #30363d; color: white; padding: 10px; border-radius: 8px; width: 100%; outline: none; transition: 0.2s; cursor: pointer; }
        .tab-btn { padding: 12px; color: #8b949e; cursor: pointer; transition: 0.2s; font-size: 10px; font-weight: bold; text-transform: uppercase; border-left: 3px solid transparent; text-align: left; width: 100%; display: flex; align-items: center; gap: 8px; }
        .tab-btn.active { color: white; border-left-color: #238636; background: rgba(35, 134, 54, 0.1); }
        .price-tag { color: #e3b341; font-family: monospace; font-weight: bold; }
        .tier-badge { background: #238636; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; }
        .item-icon { width: 32px; height: 32px; object-fit: contain; image-rendering: pixelated; }
        .stat-card { background: #161b22; border: 2px solid #30363d; border-radius: 12px; padding: 15px; text-align: center; flex: 1; }
        .stat-card.copper { border-color: #c2780e; }
        .stat-card.items { border-color: #3b82f6; }
        .stat-card.coins { border-color: #e3b341; }
    </style>
</head>
<body class="p-4 md:p-10">

<div class="max-w-5xl mx-auto">
    <header class="mb-8 border-b border-[#30363d] pb-6 flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-black text-white uppercase italic tracking-tighter">Composter <span class="text-[#238636]">Master</span></h1>
            <p class="text-[#8b949e] text-[10px] font-bold tracking-[0.3em] uppercase mt-1">Live Bazaar Online</p>
        </div>
        <div class="text-right glass !py-2 !px-4 border-emerald-500/30 cursor-pointer" onclick="fetchPrices()">
            <p class="text-[9px] uppercase font-bold text-gray-500 mb-1">Bazaar Status</p>
            <p id="statusDisplay" class="text-yellow-500 font-bold text-xs uppercase">Verbinde...</p>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="space-y-6">
            <div class="glass border-t-4 border-[#238636]">
                <p class="text-[10px] font-bold text-gray-500 uppercase mb-4 tracking-widest text-center italic">Kategorie Fokus</p>
                <div class="flex flex-col" id="tabBar">
                    <button class="tab-btn active" onclick="setCat('speed', this)">âš¡ Speed Upgrades</button>
                    <button class="tab-btn" onclick="setCat('multi_drop', this)">ðŸŒ¸ Multi Drop</button>
                    <button class="tab-btn" onclick="setCat('fuel_cap', this)">ðŸ”‹ Fuel Capacity</button>
                    <button class="tab-btn" onclick="setCat('organic_matter_cap', this)">ðŸŒ¿ OM Capacity</button>
                    <button class="tab-btn" onclick="setCat('cost_reduction', this)">ðŸ“‰ Cost Reduction</button>
                </div>
            </div>

            <div class="glass">
                <label class="text-[10px] uppercase font-bold text-gray-500 block mb-2">Stufe wÃ¤hlen</label>
                <select id="lvlInput" onchange="calculate()">
                    <option value="all">ALLE (0 bis 25)</option>
                </select>
            </div>
        </div>

        <div class="lg:col-span-2 space-y-6">
            <div class="flex gap-4">
                <div class="stat-card copper">
                    <p class="text-[10px] text-gray-400 uppercase font-bold">Kupfer Gesamt</p>
                    <p id="statCopper" class="text-2xl font-black text-white">0</p>
                </div>
                <div class="stat-card items">
                    <p class="text-[10px] text-gray-400 uppercase font-bold">Item-Arten</p>
                    <p id="statItems" class="text-2xl font-black text-white">0</p>
                </div>
                <div class="stat-card coins">
                    <p class="text-[10px] text-gray-400 uppercase font-bold">Gesamtkosten</p>
                    <p id="statCoins" class="text-2xl font-black text-[#e3b341]">0</p>
                </div>
            </div>

            <div id="materialList" class="space-y-3"></div>
        </div>
    </div>
</div>

<script>
const localPath = "img/";

const itemConfig = {
    "Copper": { id: "COPPER", img: "copper.png" },
    "Cropie": { id: "CROPIE", img: "cropie.png" },
    "Squash": { id: "SQUASH", img: "squash.png" },
    "Fermento": { id: "FERMENTO", img: "fermento.png" },
    "Condenset Fermento": { id: "CONDENSED_FERMENTO", img: "condensed_fermento.png" },
    "Enchanted Enchanted Wheat": { id: "ENCHANTED_HAY_BALE", img: "Enchanted_wheat.png" },
    "Enchanted Hay Bale": { id: "ENCHANTED_HAY_BALE", img: "enchanted_hay_bale.png" },
    "Enchanted Wheat": { id: "ENCHANTED_HAY_BALE", img: "Enchanted_wheat.png" },
    "Enchanted Golden Carrot": { id: "ENCHANTED_GOLDEN_CARROT", img: "enchanted_golden_carrot.png" },
    "Enchanted Golden Enchanted Golden Carrot": { id: "ENCHANTED_GOLDEN_CARROT", img: "enchanted_golden_carrot.png" },
    "Enchanted Melon Block": { id: "ENCHANTED_MELON_BLOCK", img: "Enchanted_Melon.png" },
    "Enchanted Pumpkin": { id: "ENCHANTED_PUMPKIN", img: "Enchanted_pumpkin.png" },
    "Polished Pumpkin": { id: "POLISHED_PUMPKIN", img: "Polished_Pumpkin.png" },
    "Enchanted Sugar Cane": { id: "ENCHANTED_SUGAR_CANE", img: "Enchanted_Sugar_Cane.png" },
    "Enchanted Red Mushroom Block": { id: "ENCHANTED_RED_MUSHROOM_BLOCK", img: "Enchanted_Red_Mushroom_Block.png" },
    "Enchanted Baked Potato": { id: "ENCHANTED_BAKED_POTATO", img: "enchanted_baked_potato.png" },
    "Mutant Nether Wart Block": { id: "MUTANT_NETHER_WART_BLOCK", img: "mutant_nether_wart.png" },
    "Enchanted Brown Mushroom": { id: "ENCHANTED_BROWN_MUSHROOM", img: "Enchanted_Brown_Mushroom.png" },
    "Enchanted Brown Mushroom Block": { id: "ENCHANTED_BROWN_MUSHROOM_BLOCK", img: "Enchanted_Brown_Mushroom_Block.png" },
    "Enchanted Cookie": { id: "ENCHANTED_COOKIE", img: "Enchanted_Cookie.png" },
    "Enchanted Cactus": { id: "ENCHANTED_CACTUS", img: "Enchanted_Cactus.png" },
};

const tiers = [
    { copper: 100, item: null, qty: 0, crops: { speed: "128x Enchanted Enchanted Wheat", drops: "1x Enchanted Melon Block", fuel: "1x Enchanted Sugar Cane", matter: "1x Enchanted Cactus", cost: "32x Enchanted Brown Mushroom" }},
    { copper: 150, item: null, qty: 0, crops: { speed: "2x Enchanted Golden Enchanted Golden Carrot", drops: "64x Enchanted Pumpkin", fuel: "4x Enchanted Melon Block", matter: "3x Enchanted Baked Potato", cost: "1x Mutant Nether Wart Block" }},
    { copper: 200, item: null, qty: 0, crops: { speed: "256x Enchanted Wheat", drops: "2x Enchanted Melon Block", fuel: "2x Enchanted Sugar Cane", matter: "2x Enchanted Cactus", cost: "2x Enchanted Red Mushroom Block" }},
    { copper: 250, item: null, qty: 0, crops: { speed: "4x Enchanted Golden Carrot", drops: "1x Polished Pumpkin", fuel: "8x Enchanted Melon Block", matter: "6x Enchanted Baked Potato", cost: "2x Mutant Nether Wart Block" }},
    { copper: 300, item: null, qty: 0, crops: { speed: "512x Enchanted Wheat", drops: "4x Enchanted Melon Block", fuel: "4x Enchanted Sugar Cane", matter: "4x Enchanted Cactus", cost: "4x Enchanted Brown Mushroom Block" }},
    { copper: 350, item: null, qty: 0, crops: { speed: "8x Enchanted Golden Carrot", drops: "2x Polished Pumpkin", fuel: "16x Enchanted Melon Block", matter: "12x Enchanted Baked Potato", cost: "4x Mutant Nether Wart Block" }},
    { copper: 400, item: null, qty: 0, crops: { speed: "8x Enchanted Hay Bale", drops: "8x Enchanted Melon Block", fuel: "8x Enchanted Sugar Cane", matter: "7x Enchanted Cactus", cost: "8x Enchanted Red Mushroom Block" }},
    { copper: 500, item: "Cropie", qty: 3, crops: { speed: "16x Enchanted Golden Carrot", drops: "4x Polished Pumpkin", fuel: "32x Enchanted Melon Block", matter: "29x Enchanted Baked Potato", cost: "8x Mutant Nether Wart Block" }},
    { copper: 600, item: "Cropie", qty: 6, crops: { speed: "12x Enchanted Hay Bale", drops: "16x Enchanted Baked Potato", fuel: "16x Enchanted Sugar Cane", matter: "10x Enchanted Cactus", cost: "16x Enchanted Brown Mushroom Block" }},
    { copper: 700, item: "Cropie", qty: 12, crops: { speed: "32x Enchanted Golden Carrot", drops: "8x Polished Pumpkin", fuel: "40x Enchanted Melon Block", matter: "48x Enchanted Baked Potato", cost: "16x Mutant Nether Wart Block" }},
    { copper: 800, item: "Cropie", qty: 24, crops: { speed: "16x Enchanted Hay Bale", drops: "32x Enchanted Baked Potato", fuel: "32x Enchanted Sugar Cane", matter: "16x Enchanted Cactus", cost: "24x Enchanted Red Mushroom Block" }},
    { copper: 900, item: "Cropie", qty: 48, crops: { speed: "40x Enchanted Golden Carrot", drops: "16x Polished Pumpkin", fuel: "48x Enchanted Melon Block", matter: "64x Enchanted Baked Potato", cost: "32x Mutant Nether Wart Block" }},
    { copper: 1000, item: "Cropie", qty: 96, crops: { speed: "24x Enchanted Hay Bale", drops: "48x Enchanted Baked Potato", fuel: "40x Enchanted Sugar Cane", matter: "24x Enchanted Mushroom", cost: "32x Enchanted Brown Mushroom Block" }},
    { copper: 1200, item: "Squash", qty: 3, crops: { speed: "48x Enchanted Golden Carrot", drops: "24x Polished Pumpkin", fuel: "64x Enchanted Melon Block", matter: "96x Enchanted Baked Potato", cost: "48x Mutant Nether Wart Block" }},
    { copper: 1400, item: "Squash", qty: 6, crops: { speed: "32x Enchanted Hay Bale", drops: "64x Enchanted Baked Potato", fuel: "48x Enchanted Sugar Cane", matter: "32x Enchanted Cactus", cost: "48x Enchanted Red Mushroom Block" }},
    { copper: 1600, item: "Squash", qty: 12, crops: { speed: "64x Enchanted Golden Carrot", drops: "32x Polished Pumpkin", fuel: "96x Enchanted Melon Block", matter: "128x Enchanted Baked Potato", cost: "64x Mutant Nether Wart Block" }},
    { copper: 1800, item: "Squash", qty: 24, crops: { speed: "40x Enchanted Hay Bale", drops: "80x Enchanted Baked Potato", fuel: "64x Enchanted Sugar Cane", matter: "40x Enchanted Cactus", cost: "64x Enchanted Brown Mushroom Block" }},
    { copper: 2000, item: "Squash", qty: 48, crops: { speed: "96x Enchanted Golden Carrot", drops: "48x Polished Pumpkin", fuel: "128x Enchanted Melon Block", matter: "160x Enchanted Baked Potato", cost: "80x Mutant Nether Wart Block" }},
    { copper: 2250, item: "Squash", qty: 96, crops: { speed: "48x Enchanted Hay Bale", drops: "112x Enchanted Baked Potato", fuel: "96x Enchanted Sugar Cane", matter: "48x Enchanted Cactus", cost: "96x Enchanted Red Mushroom Block" }},
    { copper: 2500, item: "Fermento", qty: 3, crops: { speed: "128x Enchanted Golden Carrot", drops: "64x Polished Pumpkin", fuel: "192x Enchanted Melon Block", matter: "208x Enchanted Baked Potato", cost: "112x Mutant Nether Wart Block" }},
    { copper: 2750, item: "Fermento", qty: 6, crops: { speed: "64x Enchanted Hay Bale", drops: "144x Enchanted Baked Potato", fuel: "144x Enchanted Sugar Cane", matter: "64x Enchanted Cactus", cost: "128x Enchanted Brown Mushroom Block" }},
    { copper: 3000, item: "Fermento", qty: 12, crops: { speed: "192x Enchanted Golden Carrot", drops: "96x Polished Pumpkin", fuel: "288x Enchanted Melon Block", matter: "256x Enchanted Baked Potato", cost: "160x Mutant Nether Wart Block" }},
    { copper: 3300, item: "Condenset Fermento", qty: 2, crops: { speed: "96x Enchanted Hay Bale", drops: "176x Enchanted Baked Potato", fuel: "192x Enchanted Sugar Cane", matter: "96x Enchanted Cactus", cost: "160x Enchanted Red Mushroom Block" }},
    { copper: 3600, item: "Condenset Fermento", qty: 4, crops: { speed: "256x Enchanted Golden Carrot", drops: "128x Polished Pumpkin", fuel: "384x Enchanted Melon Block", matter: "320x Enchanted Baked Potato", cost: "224x Mutant Nether Wart Block" }},
    { copper: 4000, item: "Condenset Fermento", qty: 8, crops: { speed: "128x Enchanted Hay Bale", drops: "224x Enchanted Baked Potato", fuel: "256x Enchanted Sugar Cane", matter: "128x Enchanted Cactus", cost: "192x Enchanted Brown Mushroom Block" }}
];

let bazaarPrices = {};
let currentCat = 'speed';
const catKeyMap = { speed: 'speed', multi_drop: 'drops', fuel_cap: 'fuel', organic_matter_cap: 'matter', cost_reduction: 'cost' };

async function fetchPrices() {
    document.getElementById('statusDisplay').innerText = "LADE...";
    try {
        const res = await fetch('https://api.slothpixel.me/api/skyblock/bazaar');
        const data = await res.json();
        
        // Konvertierung von Slothpixel zu Hypixel-Format
        bazaarPrices = {};
        for (const [id, info] of Object.entries(data)) {
            bazaarPrices[id] = { quick_status: { buyPrice: info.quick_status.buyPrice } };
        }
        
        document.getElementById('statusDisplay').innerText = "LIVE (SLOTH)";
        document.getElementById('statusDisplay').className = "text-emerald-500 font-bold text-xs uppercase";
        calculate();
    } catch (e) {
        document.getElementById('statusDisplay').innerText = "FEHLER (OFFLINE)";
    }
}

function calculate() {
    const mode = document.getElementById('lvlInput').value;
    const list = document.getElementById('materialList');
    list.innerHTML = "";
    let totalCopper = 0; let totalCoins = 0; let aggregated = {};

    const process = (t) => {
        totalCopper += t.copper;
        const cS = t.crops[catKeyMap[currentCat]].split('x ');
        const qty = parseInt(cS[0]); const name = cS[1].trim();
        const conf = itemConfig[name];
        if(conf) {
            if(!aggregated[conf.id]) aggregated[conf.id] = { name: name, qty: 0, img: conf.img };
            aggregated[conf.id].qty += qty;
        }
        if (t.item) {
            const iC = itemConfig[t.item];
            if(iC) {
                if(!aggregated[iC.id]) aggregated[iC.id] = { name: t.item, qty: 0, img: iC.img };
                aggregated[iC.id].qty += t.qty;
            }
        }
    };

    if(mode === "all") tiers.forEach(process);
    else process(tiers[parseInt(mode)]);

    let displayItems = [];
    for(const id in aggregated) {
        const price = (bazaarPrices[id]?.quick_status.buyPrice || 0) * aggregated[id].qty;
        totalCoins += price;
        displayItems.push({...aggregated[id], totalCost: price});
    }
    displayItems.sort((a,b) => b.totalCost - a.totalCost);

    addRow(`${totalCopper.toLocaleString()} Kupfer`, "Gesamt", "Kupfer", true, localPath + "copper.png");
    displayItems.forEach(i => addRow(`${i.qty.toLocaleString()}x ${i.name}`, "Bazaar", formatPrice(i.totalCost), false, localPath + i.img));
    
    document.getElementById('statCopper').innerText = totalCopper.toLocaleString();
    document.getElementById('statItems').innerText = displayItems.length;
    document.getElementById('statCoins').innerText = formatPrice(totalCoins);
}

function addRow(t, s, r, c, img) {
    document.getElementById('materialList').innerHTML += `<div class="flex justify-between items-center p-4 bg-white/5 rounded-lg border border-white/5 hover:border-white/10 transition-all"><div class="flex items-center gap-4"><img src="${img}" class="item-icon" onerror="this.src='https://mc-heads.net/head/010101'"><div><span class="text-sm font-bold text-white block leading-none">${t}</span><span class="text-[9px] text-gray-500 uppercase tracking-widest font-bold mt-1 block">${s}</span></div></div><div class="${c?'text-orange-500':'price-tag'} text-xs font-bold uppercase italic">${r}</div></div>`;
}

function formatPrice(n) { if(n>=1e6) return (n/1e6).toFixed(1)+"M"; if(n>=1e3) return (n/1e3).toFixed(0)+"k"; return Math.floor(n).toLocaleString(); }
function setCat(c, e) { currentCat = c; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); e.classList.add('active'); calculate(); }

const sel = document.getElementById('lvlInput');
for(let i=0; i<25; i++) sel.innerHTML += `<option value="${i}">Stufe ${i} â†’ ${i+1}</option>`;

fetchPrices();
</script>
</body>
</html>
